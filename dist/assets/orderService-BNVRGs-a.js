import{i as n,s,h as u}from"./index-KtrVGIDC.js";const d=(t,a=[])=>({id:t.id,userId:t.user_id||"",items:a.map(e=>({productId:e.product_id||"",productName:e.product_name||"",productImage:e.product_image||"",price:e.price||0,quantity:e.quantity||1})),subtotal:t.subtotal||0,shipping:t.shipping||0,total:t.total||0,status:t.status||"pending",shippingAddress:t.shipping_address||{firstName:"",lastName:"",email:"",phone:"",address:"",district:"",city:""},paymentMethod:t.payment_method||"",notes:t.notes||void 0,createdAt:new Date(t.created_at),updatedAt:new Date(t.updated_at)}),p=async t=>{if(!n()||!s)return{...t,id:`mock-${Date.now()}`,createdAt:new Date,updatedAt:new Date};const{data:a,error:e}=await s.from("orders").insert({user_id:t.userId||null,subtotal:t.subtotal,shipping:t.shipping,total:t.total,status:t.status,shipping_address:t.shippingAddress,payment_method:t.paymentMethod,notes:t.notes}).select().single();if(e||!a)throw new Error(u(e));if(t.items.length>0){const r=t.items.map(i=>({order_id:a.id,product_id:i.productId,product_name:i.productName,product_image:i.productImage,price:i.price,quantity:i.quantity})),{error:o}=await s.from("order_items").insert(r)}return d(a,[])},m=async t=>{if(!n()||!s)return[];const{data:a,error:e}=await s.from("orders").select("*").eq("user_id",t).order("created_at",{ascending:!1});return e?[]:await Promise.all((a||[]).map(async o=>{const{data:i}=await s.from("order_items").select("*").eq("order_id",o.id);return d(o,i||[])}))},l=async()=>{if(!n()||!s)return[];const{data:t,error:a}=await s.from("orders").select("*").order("created_at",{ascending:!1});return a?[]:await Promise.all((t||[]).map(async r=>{const{data:o}=await s.from("order_items").select("*").eq("order_id",r.id);return d(r,o||[])}))},_=async(t,a)=>{if(!n()||!s)return null;const{data:e,error:r}=await s.from("orders").update({status:a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw new Error(u(r));return e?d(e):null};export{m as a,p as c,l as g,_ as u};
